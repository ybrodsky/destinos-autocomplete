"use strict";angular.module("destinos-autocomplete",["ng","ngResource","ui.bootstrap","Gdo"]).factory("Api",function($resource){return $resource(destinos_url+"/api",{},{ciudades:{url:destinos_url+"/api/cities",method:"GET",headers:{ajaxLoader:!1},withCredentials:!1,isArray:!0},regiones:{url:destinos_url+"/api/regions",method:"GET",headers:{ajaxLoader:!1},withCredentials:!1,isArray:!0},paises:{url:destinos_url+"/api/countries",method:"GET",headers:{ajaxLoader:!1},withCredentials:!1,isArray:!0},aeropuertos:{url:destinos_url+"/api/aeropuertos",method:"GET",headers:{ajaxLoader:!1},withCredentials:!1,isArray:!0}})}).directive("destinosAutocomplete",["$templateCache",function($templateCache){return{restrict:"AE",scope:{model:"=",selected:"=?",settings:"=?"},templateUrl:"template.html",controller:"DestinosAutocompleteCtrl"}}]).controller("DestinosAutocompleteCtrl",["$scope","Api","$q",function($scope,Api,$q){function getCiudades(name){var where={$or:[{name:{$like:"%"+name+"%"}},{code:name}]};return $scope.defaults.iata&&(where.code={$ne:""}),Api.ciudades({where:where,include:JSON.stringify([{model:"Country",attributes:["name","region_id"]}])}).$promise.then(function(res){return res.map(function(item){if(item.Country)return{label:item.name+", "+item.Country.name,value:item.id,pais:item.country_id||null,region:item.Country.region_id||null,code:item.code||null,hoteldo:item.hdo_code||null,tourico:item.tourico_code||null,hotelbeds:item.hotelbeds_code||null,infinitas:item.infinitas_code||null,lat:item.lat||null,lon:item.lon||null,esCiudad:!0}})})}function getPaises(name){return Api.paises({attributes:JSON.stringify(["id","name","code"]),where:{$or:[{name:{$like:"%"+name+"%"}},{code:name}]}}).$promise.then(function(res){return res.map(function(item){return{label:item.name,value:item.id,esPais:!0}})})}function getCompletos(name){return $q.all([Api.regiones({attributes:JSON.stringify(["id","name","code"]),where:{$or:[{name:{$like:"%"+name+"%"}},{code:name}]}}).$promise,Api.paises({attributes:JSON.stringify(["id","name","region_id","code"]),where:{$or:[{name:{$like:"%"+name+"%"}},{code:name}]}}).$promise,Api.ciudades({where:{$or:[{name:{$like:"%"+name+"%"}},{code:name}]},include:JSON.stringify([{model:"Country",attributes:["name"]}])}).$promise]).then(function(results){var data=[];return results.forEach(function(result){data=data.concat(result)}),data.map(function(item){return{label:item.name+(item.Country?", "+item.Country.name:""),value:item.id,country_id:item.country_id||null,region_id:item.region_id||null,pais:item.country_id||null,esCiudad:!!item.country_id,esPais:!item.country_id}})})}function getAeropuertos(name){return $q.all([Api.ciudades({where:{$or:[{name:{$like:"%"+name+"%"}},{code:name}]},include:JSON.stringify([{model:"Country",attributes:["name"]}])}).$promise,Api.aeropuertos({where:{$or:[{name:{$like:"%"+name+"%"}},{code:name}]},include:JSON.stringify([{model:"City",attributes:["name"]}])}).$promise]).then(function(results){var data=[];return results.forEach(function(result){data=data.concat(result)}),data.map(function(item){return{label:item.name+", "+(item.Country?item.Country.name:item.City.name),value:item.id,code:item.code,esAeropuerto:!item.country_id,esCiudad:!!item.country_id}})})}$scope.selected=$scope.selected||"",$scope.defaults={placeholder:"Ingresá 3 letras y seleccioná del listado",emptyBtn:!1,destino:"ciudades",iata:!1,isArray:!1,emptyAfterSelect:!1,onSelect:null},$scope.defaults=angular.merge($scope.defaults,$scope.settings);switch($scope.defaults.destino){case"ciudades":$scope.getDestinos=getCiudades;break;case"paises":$scope.getDestinos=getPaises;break;case"completos":$scope.getDestinos=getCompletos;break;case"aeropuertos":$scope.getDestinos=getAeropuertos}$scope.vaciar=function(){$scope.model=null,$scope.selected=""},$scope.onSelect=function(data){1==$scope.defaults.isArray?($scope.model.push(data),$scope.selected=""):($scope.defaults.emptyAfterSelect&&($scope.selected=""),$scope.model=data),setTimeout(function(){$scope.defaults.onSelect&&$scope.$parent[$scope.defaults.onSelect](data)},10)}}]).factory("httpInterceptor",["$q","$rootScope",function($q,$rootScope){return{request:function(config){return delete config.headers.ajaxLoader,config||$q.when(config)}}}]).config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push("httpInterceptor")}]);
!function(t){try{t=angular.module("Gdo")}catch(a){t=angular.module("Gdo",[])}t.run(["$templateCache",function(t){t.put("template.html",'<div class="input-group">\n\t<input\n\t\ttype="text"\n\t\tng-model="selected"\n\t\tplaceholder="{{defaults.placeholder}}"\n\t\tuib-typeahead="n as n.label for n in getDestinos($viewValue)"\n\t\ttypeahead-loading="loading"\n\t\ttypeahead-no-results="noResults"\n\t\tclass="form-control"\n\t\ttypeahead-min-length="3"\n\t\ttypeahead-on-select="onSelect($item, $model, $label, $event)"\n\t\ttypeahead-wait-ms="200"\n\t\ttypeahead-template-url="customTemplate.html"\n\t/>\n\t<span class="input-group-btn">\n\t\t<button class="btn btn-default" type="button" ng-show="loading">\n\t\t\t<i class="fa fa-refresh fa-spin"></i>\n\t\t</button>\n\t\t<button class="btn btn-default" type="button" ng-show="!loading" ng-click="vaciar()" ng-disabled="!defaults.emptyBtn">\n\t\t\t<i class="fa fa-times"></i>\n\t\t</button>\n  </span>\n</div>')}])}(),function(t){try{t=angular.module("Gdo")}catch(a){t=angular.module("Gdo",[])}t.run(["$templateCache",function(t){t.put("customTemplate.html","<a>\n  <i class=\"fa \" ng-class=\"{'fa-map-marker': match.model.esCiudad, 'fa-globe': match.model.esPais, 'fa-plane': match.model.esAeropuerto}\"></i> &nbsp;\n  <span ng-bind-html=\"match.label | uibTypeaheadHighlight:query\"></span>\n</a>")}])}();